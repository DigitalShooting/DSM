extends index.jade

block stand
	script.
		var socket = io("//#{stand.ip}:#{stand.port}")
		
		var session
		socket.on('setSession', function(newSession){
			console.log(newSession)
			session = newSession
			setUpDisziplinen()
		});
		var config
		socket.on('setConfig', function(c){
			console.log(c)
			config = c
			setUpDisziplinen()
		});
		socket.on('newShot', function(shot){
			//console.log(shot)
		});
		
		
		var schuetzen = !{JSON.stringify(schuetzen)}
		
		
		function setUpDisziplinen(){
			if (config && session){
				var disziplinen = config.disziplinen
				
				$(".stand .disziplin").html("")
				for(var key in disziplinen){
					var disziplin = disziplinen[key]
					$(".stand .disziplin").append("<option value='"+key+"'>"+disziplin.title+"</option>")
				}
				
				console.log(session.disziplin._id)
				$(".stand .disziplin").val(session.disziplin._id).trigger("change")
			}
		}
		
		
		function sendDisziplin(){
			var disziplin = $('.stand .disziplin option:selected').val();
			socket.emit('setDisziplin', disziplin)
		}
		function sendSchuetze(){
			var schuetzeID = $('.stand .schuetze option:selected').val();
			
			for (var i in schuetzen){
				var schuetze = schuetzen[i]
				if (schuetze._id == schuetzeID){
					socket.emit('setUser', schuetze)
					break
				}
			}
			
			
		}
	
	div(class="stand")
		div(class="panel panel-default")
			div(class="panel-heading") Disziplin
			div(class="panel-body")
				div(class="form-horizontal")
					+inputSelect("disziplin", [], false, "Disziplin")
					input(type="submit" class="btn btn-primary pull-right" onclick="sendDisziplin()")
				
				
		div(class="panel panel-default")
			div(class="panel-heading") Schütze
			div(class="panel-body")
				div(class="form-horizontal")
					- var optionSchuetze = []
					- schuetzen.forEach(function(schuetze){ optionSchuetze.push({id: schuetze._id, title: schuetze.vorname + " " + schuetze.name}) })
					+inputSelect("schuetze", optionSchuetze, false, "Schütze")
				
					input(type="submit" class="btn btn-primary pull-right" onclick="sendSchuetze()")
					//a(href="../delete/" class="btn btn-default pull-left") Gast
		
		div(class="panel panel-default")
			div(class="panel-heading") Aktionen
			div(class="panel-body")
				//a(href="../delete/" class="btn btn-default pull-left") Neue Scheibe
				//a(href="../delete/" class="btn btn-success pull-left") Match
				//a(href="../delete/" class="btn btn-default pull-left") History
			
		
